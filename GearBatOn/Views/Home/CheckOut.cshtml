@model GearBatOn.Models.Invoice
@using GearBatOn.Models

@{
    ViewBag.Title = "CheckOut";
    Layout = "~/Views/Shared/_Layout.cshtml";
    int number = 1;
    List<Item> items = new List<Item>();
    items = (List<Item>)Session["cart"]; //ép kiểu về list
}

<h2 style="text-align: center">Giỏ Hàng</h2>


<div>
    @if (items.Count == 0)
    {
        <div style="text-align: center">
            <div>Không có sản phẩm nào trong giỏ hàng!</div>
            <a style="text-decoration: none" href="@Url.Action("Index", "Home")"><i class="fa fa-reply"></i>Tiếp tục mua hàng</a>
        </div>
    }
    else
    {
        using (Html.BeginForm())
        {
            @Html.AntiForgeryToken()

            <div class="form-horizontal">
                @Html.ValidationSummary(true, "", new { @class = "text-danger" })


                <table class="table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Hình ảnh</th>
                            <th>Tên sản phẩm</th>
                            <th>Số lượng</th>
                            <th>Giá tiền</th>
                            <th>Xóa</th>
                        </tr>
                    </thead>
                    <tbody>
                    @foreach (var item in items)
                    {
                        <tr>
                            <th scope="row">@number</th>
                            <td>
                                <img src="@Url.Content(item.Product.FeatureImage ?? "~/Images/empty-image.png")" class="card-img-top" style="width: 230px; height: 230px; object-fit: cover;">
                            </td>
                            <td> @item.Product.Name </td>
                            <td>
                                <a href="@Url.Action("Minus","Home", new { Id = item.Product.Id })">
                                    <i class="fa fa-minus-square-o" aria-hidden="true"></i>
                                </a>
                                <span class="badge bg-secondary">@item.Quantity</span>
                                <a href="@Url.Action("Plus","Home", new { Id = item.Product.Id })">
                                    <i class="fa fa-plus-square-o" aria-hidden="true"></i>
                                </a>
                            </td>
                            <td> @item.Product.Price </td>
                            <td>
                                <a class="btn btn-outline-dark" href="@Url.Action("RemoveFromCheckOut", "Home", new { Id = item.Product.Id })">
                                    <i class="fa fa-trash"></i>
                                </a>
                            </td>
                        </tr>
                        number++;
                    }
                    </tbody>
                    <tfoot></tfoot>
                </table>



                <table class="table table-borderless">
                    <thead>

                    </thead>
                    <tbody>
                        <tr>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th class="pull-right">
                                Tạm tính : &nbsp;
                                @if (Session["cart"] != null)
                                {
                                    int c = 0;
                                    int a, b;
                                    foreach (var Item in items)
                                    {
                                        a = Convert.ToInt32(Item.Product.Price);
                                        b = Item.Quantity;
                                        c = c + a * b;
                                    }
                                    string s = string.Format("{0:#,##0.00}", c);
                                    @s
                                }
                                &nbsp;VND
                            </th>
                        </tr>
                    </tbody>
                </table>
                <table class="table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>Quốc gia :</th>
                            <th>Tỉnh :</th>
                            <th>Địa chỉ chi tiết :</th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        
                        <tr>
                            <th>Địa chỉ giao hàng :&nbsp;</th>
                            <th>
                                <div class="form-group">
                                    <div style="width: 140px" class="col-md-10">
                                        @Html.DropDownList("CountryId", new SelectList(Model.countries, "Id", "Name"), htmlAttributes: new { @class = "form-control" })
                                        @Html.ValidationMessageFor(model => model.CountryId, "", new { @class = "text-danger" })
                                    </div>
                                </div>
                            </th>
                            <td>
                                <div class="form-group">
                                    <div style="width: 140px" class="col-md-10">
                                        @Html.DropDownList("ProvinceId", new SelectList(Model.provinces, "Id", "Name"), htmlAttributes: new { @class = "form-control" })
                                        @Html.ValidationMessageFor(model => model.ProvinceId, "", new { @class = "text-danger" })
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="form-group">
                                    <div class="col-md-10">
                                        @Html.TextAreaFor(model => model.Address, new { htmlAttributes = new { @class = "form-control" } })
                                        @Html.ValidationMessageFor(model => model.Address, "", new { @class = "text-danger" })
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="form-group">
                                    <div id="Ratio" class="col-md-10">
                                        @Html.DropDownList("PromotionId", new SelectList(Model.promotions, "Id", "PromoCode"), htmlAttributes: new { @class = "form-control" })
                                        @Html.ValidationMessageFor(model => model.PromotionId, "", new { @class = "text-danger" })
                                    </div>
                                </div>
                            </td>
                            <td>
                            </td>
                        </tr>
                    </tbody>
                    <tfoot></tfoot>
                </table>

                <table class="table table-borderless">
                    <tbody>
                        <tr>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th class="pull-right">Giảm :&nbsp; 
                                @*<span id="ratio"></span>*@           @* HIển thị giảm giá *@
                                VND
                            </th>
                        </tr>
                        <tr>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th class="pull-right"><h3>Tổng tiền : &nbsp;
                                @* Hiển thị tổng tiền phải trả *@
                                VND
                                </h3>
                            </th>
                        </tr>
                        <tr>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th class="pull-right" >
                                <div class="form-group">
                                    <div class="col-md-10">
                                        <div style="width: 170px" class="checkbox">
                                            Thanh toán online &nbsp                                  
                                            @Html.EditorFor(model => model.PaymentStatus)
                                            @Html.ValidationMessageFor(model => model.PaymentStatus, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>
                            </th>
                        </tr>
                    </tbody>
                </table>

                <div class="pull-right form-group">
                    <div class="col-md-offset-2 col-md-10">
                        <input type="submit" value="Thanh toán" class="btn btn-success" />
                    </div>
                </div>
            </div>
        }
        <br /><br /><br />
        <div style="text-align: center">
            <a style="text-decoration: none" href="@Url.Action("Index", "Home")"><i class="fa fa-reply"></i>Tiếp tục mua hàng</a>
        </div>
    }
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}
